name: Sync to Game Hub

on:
  workflow_run:
    workflows: ['CI']
    types:
      - completed
    branches:
      - main
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    if: ${{ github.event_name == 'workflow_dispatch' || github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Trigger hub sync
        env:
          GH_TOKEN: ${{ secrets.GAME_SYNC_TOKEN }}
        run: |
          gh workflow run receive-game-sync.yml \
            --repo jsevenheck/game-hub \
            --field game-id=YOUR_GAME_ID \
            --field source-ref=${{ github.sha }}
